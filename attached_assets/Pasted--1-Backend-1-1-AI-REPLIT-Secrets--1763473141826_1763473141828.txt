שלב 1: הכנת התשתית והגדרות (Backend)1.1. הגדרת מפתח AI (REPLIT Secrets)כדי לתקשר עם מודלי שפה גדולים (LLMs) כגון OpenAI, עליך להשתמש במפתח API.פעולה ב-REPLIT:פתח את מסך ה-Secrets והוסף את המפתח הבא:KeyValueOPENAI_API_KEYYOUR_SECRET_KEY_FROM_OPENAI1.2. התקנת חבילת ה-AIפעולה בטרמינל REPLIT:Bashnpm install openai
1.3. יצירת פונקציית שליפת נתונים היסטורייםכדי שה-AI ייתן המלצות חכמות, הוא זקוק לנתונים של העסק הספציפי.צור קובץ: src/services/eventDataService.js (או עדכן קובץ קיים)JavaScript// קריאה ל-DB (MongoDB או PostgreSQL) כדי לשלוף נתונים קריטיים
export async function getHistoricalData(userId) {
    // 1. שלוף את 10 האירועים האחרונים של המשתמש מה-DB
    const userEvents = await EventModel.find({ organizerId: userId })
        .sort({ date: -1 })
        .limit(10)
        .select('title price date registrationCount attendanceRate');

    // 2. שלוף ממוצעים אנונימיים מהפלטפורמה כולה (נתונים גלובליים לשיפור ה-AI)
    const platformAverages = {
        avgConversionRate: 0.035, // 3.5% (זה ניתן לשליפה מחישוב גלובלי של כל האירועים)
        avgPeakTime: "Wednesday 19:00",
    };

    return {
        userEvents,
        platformAverages
    };
}
🛠️ שלב 2: בניית שירות ה-AI (הלוגיקה הפרימיומית)2.1. יצירת שירות ה-AIצור קובץ: src/services/aiService.jsהקוד הזה יבנה את ה-Prompt המפורט (על סמך הטבלה שסיפקת) ויקרא ל-OpenAI API.JavaScriptimport OpenAI from 'openai';
import { getHistoricalData } from './eventDataService'; 

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export async function getPerformanceInsights(eventId, eventData, userId) {
    const historicalData = await getHistoricalData(userId); 
    
    // ודא שהאירוע כולל את כל הפרטים הדרושים (כמו COGS לחישוב ROI)
    const costOfGoods = eventData.cogs || 50; // עלות משתנה (אם לא קיים, הגדר ברירת מחדל)

    // *** בניית ה-Prompt המרכזי ***
    const prompt = `
        אתה יועץ ביצועים עסקי (AI Performance Coach) המתמחה בניהול אירועים והשקות.
        המטרה שלך היא לספק המלצות פרקטיות ומוכוונות רווח לבעל עסק (משתמש ID: ${userId}).
        
        --- נתונים לניתוח ---
        1. האירוע הנוכחי:
           - מחיר: ${eventData.price} ₪
           - מועד: ${eventData.date}
           - רווח גולמי (לפני שיווק): ${eventData.price - costOfGoods} ₪
        2. ביצועים היסטוריים של המשתמש: ${JSON.stringify(historicalData.userEvents)}
        3. ממוצע פלטפורמה אנונימי: ${JSON.stringify(historicalData.platformAverages)}
        
        --- משימה: ניתוח והמלצות (השב בפורמט Markdown בעברית) ---
        
        1. **תמחור אופטימלי (The Pricing Optimizer):**
           - נתח את הנתונים ההיסטוריים וקבע האם מחיר ${eventData.price} ₪ הוא המחיר הממקסם מכירות.
           - המלץ על מחיר מדויק חדש, או אשר את המחיר הנוכחי והסבר מדוע.
           
        2. **זמן ומיקום מיטביים (The Timing Optimizer):**
           - השווה את תאריך ${eventData.date} למגמות העבר. האם יש שעה/יום אחרים שהביאו אחוזי המרה גבוהים יותר לעסק זה?
           - המלץ על השינוי הדרוש או אשר את המועד הנוכחי.
           
        3. **אופטימיזציה של דף ההרשמה (Conversion Rate):**
           - בהתבסס על נתוני הפלטפורמה, המלץ על שינוי אחד ספציפי בדף ההרשמה (למשל, תמונה, טקסט, הוספת וידאו) שיכול להעלות את אחוזי ההמרה.
        
        השב באופן ישיר, ללא הקדמות.
    `;

    try {
        const response = await openai.chat.completions.create({
            model: "gpt-4o-mini",
            messages: [{ role: "user", content: prompt }],
            max_tokens: 600,
        });
        
        return response.choices[0].message.content;
    } catch (error) {
        // במידה של שגיאת API, החזר הודעה מובנית
        return "שגיאה בחישוב AI. בדוק את מפתח ה-API או את פורמט הנתונים.";
    }
}
🛠️ שלב 3: חסימת ה-API (פרימיום Middleware)וודא שה-Route המשתמש בשירות ה-AI מוגן באמצעות ה-Middleware isPremium שהגדרנו קודם לכן.במודול ה-Routes שלך (למשל, src/routes/premiumRoutes.js):JavaScriptimport express from 'express';
// ודא שה-Middleware הזה קיים ומיישם את הבדיקה: req.user.subscriptionStatus === 'ACTIVE'
import { isPremium } from '../middleware/authMiddleware'; 
import { getPerformanceInsights } from '../services/aiService';

const router = express.Router();

// Route זה זמין רק למשתמשי פרימיום
router.get('/ai/performance/:eventId', isPremium, async (req, res) => {
    try {
        const { eventId } = req.params;
        const userId = req.user.id;
        
        // 1. שלוף את נתוני האירוע (המחיר והעלות המשתנה נחוצים)
        const eventData = await getEventById(eventId, userId); 
        
        if (!eventData) {
            return res.status(404).json({ message: "Event not found." });
        }
        
        // 2. קריאה לשירות ה-AI
        const insights = await getPerformanceInsights(eventId, eventData, userId);
        
        res.json({ insights });

    } catch (error) {
        console.error('Error fetching AI insights:', error);
        res.status(500).json({ message: 'Internal Server Error' });
    }
});

// ודא שאתה מייצא ומשתמש ב-Routes זה ב-app.js
export default router; 
🛠️ שלב 4: ממשק המשתמש (Frontend Gating & Display)נשתמש בקומפוננטה שתוצג בתוך עורך האירועים או בדאשבורד, ותשתמש בצבעי ה-Teal & Slate היוקרתיים.ב-src/components/AIInsightsCard.jsx:JavaScriptimport React, { useState, useEffect } from 'react';
import axios from 'axios';
import { useAuth } from '../context/AuthContext'; 

const AIInsightsCard = ({ eventId }) => {
    // נניח שקונטקסט האותנטיקציה מספק את המשתמש
    const { user, navigate } = useAuth(); 
    const [insights, setInsights] = useState(null);
    const [isLoading, setIsLoading] = useState(false);

    // *** לוגיקת חסימת הפרימיום (Gating) ***
    if (user.subscriptionStatus !== 'ACTIVE') {
        return (
            <div className="bg-bg-card p-6 rounded-lg shadow-xl border border-accent-teal/30 rtl">
                <h3 className="text-xl font-bold text-text-primary mb-3">👑 AI Performance Coach</h3>
                <p className="text-text-secondary mb-4">
                    פיצ'ר ה-AI לפיצוח תמחור, מיקום ואופטימיזציה זמין רק למנויי פרימיום. שדרג עכשיו כדי לקבל המלצות מבוססות דאטה.
                </p>
                <button 
                    className="bg-accent-teal hover:bg-accent-hover text-white py-2 px-4 rounded transition duration-200"
                    onClick={() => navigate('/billing')} 
                >
                    שדרג ל-AI Premium
                </button>
            </div>
        );
    }

    // ... (פונקציית fetchInsights ו-useEffect כפי שסופקו קודם לכן)
    
    // ... (הקוד להצגת ה-Insights)
    return (
        <div className="bg-bg-card p-6 rounded-lg shadow-xl border-t-4 border-accent-teal rtl">
            <h3 className="text-2xl font-bold text-accent-teal mb-4 flex items-center">
                <span className="ml-2 text-3xl">🤖</span> AI Performance Coach: המלצות אסטרטגיות
            </h3>
            {isLoading ? (
                <p className="text-text-secondary">מחשב נתונים היסטוריים ומגמות פלטפורמה...</p>
            ) : (
                <div 
                    className="text-text-primary prose max-w-none" // Tailwind Prose למראה נקי של Markdown
                    dangerouslySetInnerHTML={{ __html: insights }} 
                />
            )}
        </div>
    );
};